---
phase: 03-audio-core-polish
plan: 01
type: execute
---

<objective>
Set up LUFS measurement infrastructure with ebur128 crate.

Purpose: Establish the foundation for loudness measurement without changing existing behavior.
Output: ebur128 dependency added, AudioData struct extended with lufs field.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/ARCHITECTURE.md
@.planning/codebase/STACK.md
@.planning/phases/03-audio-core-polish/03-RESEARCH.md
@.planning/phases/03-audio-core-polish/03-CONTEXT.md

**Prior decisions affecting this plan:**
- ebur128 0.1 is the standard Rust crate (pure Rust, EBU R128 compliant)
- LUFS calculation at import time, not live playback
- Volume Engine V2 is extension, not replacement

**Relevant source files:**
@src-tauri/Cargo.toml
@src-tauri/src/audio/mod.rs

**Constraints:**
- User-facing strings must be in English
- Coverage must stay same or increase
- Commit after plan completion with Problem/Solution format
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create feature branch and establish baseline</name>
  <files>N/A (git operations)</files>
  <action>
    1. Create feature branch: `git checkout develop && git pull && git checkout -b feature/audio-core-polish`
    2. Run Rust coverage baseline: `cd src-tauri && cargo llvm-cov --fail-under-lines 0`
    3. Document baseline percentage in summary
  </action>
  <verify>`git branch --show-current` returns `feature/audio-core-polish`</verify>
  <done>Feature branch created, baseline coverage documented</done>
</task>

<task type="auto">
  <name>Task 2: Add ebur128 dependency</name>
  <files>src-tauri/Cargo.toml</files>
  <action>
    Add ebur128 dependency in the [dependencies] section:
    ```toml
    ebur128 = "0.1"
    ```

    Run `cargo check` to verify dependency resolves correctly.
  </action>
  <verify>`cargo check --manifest-path src-tauri/Cargo.toml` passes</verify>
  <done>ebur128 0.1.x added to Cargo.toml</done>
</task>

<task type="auto">
  <name>Task 3: Extend AudioData struct with lufs field</name>
  <files>src-tauri/src/audio/mod.rs</files>
  <action>
    1. Add `lufs` field to AudioData struct:
       ```rust
       pub struct AudioData {
           pub samples: Vec<f32>,
           pub sample_rate: u32,
           pub channels: u16,
           pub lufs: Option<f32>,  // Integrated loudness (LUFS), None if unavailable
       }
       ```

    2. Update all AudioData instantiations to include `lufs: None`
       - Search for `AudioData {` patterns in decode.rs and other files
       - Add `lufs: None` to each instantiation

    3. If AudioData has a constructor or builder, update it too
  </action>
  <verify>`cargo check --manifest-path src-tauri/Cargo.toml` passes</verify>
  <done>AudioData has lufs: Option<f32> field, all instantiations updated</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cargo check --manifest-path src-tauri/Cargo.toml` passes
- [ ] ebur128 dependency in Cargo.toml
- [ ] AudioData struct has lufs field
- [ ] All AudioData instantiations compile
</verification>

<success_criteria>
- Feature branch created from develop
- ebur128 = "0.1" in Cargo.toml
- AudioData extended with lufs: Option<f32>
- No compilation errors
- Baseline coverage documented
</success_criteria>

<output>
After completion, create `.planning/phases/03-audio-core-polish/03-01-SUMMARY.md`

Include:
- Baseline coverage percentage
- ebur128 version resolved
- Files modified
- Ready for Plan 02
</output>
