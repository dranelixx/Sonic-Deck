---
phase: 04-auto-updater
plan: 02
type: execute
---

<objective>
Frontend UI für Update-Benachrichtigung und Installation erstellen.

Purpose: Dezente, user-kontrollierte Update-Experience gemäß CONTEXT.md Vision.
Output: Header-Badge, Update-Hook, und Update-Dialog mit Changelog-Kurzfassung.

**Branch:** `feature/auto-updater` (weiter auf bestehendem Branch)
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-auto-updater/04-CONTEXT.md
@.planning/phases/04-auto-updater/04-RESEARCH.md
@.planning/phases/04-auto-updater/04-01-SUMMARY.md

**User Vision (aus CONTEXT.md):**
- Dezente Benachrichtigung in Header/Titelleiste
- Kurzfassung der Änderungen vor Download-Entscheidung
- User entscheidet wann und ob Update
- Kein automatischer Download

**Relevant source files:**
@src/App.tsx
@src/components/dashboard/DashboardHeader.tsx
@src/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: useUpdateCheck Hook erstellen</name>
  <files>src/hooks/useUpdateCheck.ts</files>
  <action>
    Hook erstellen mit folgender Funktionalität:

    1. State-Management:
       - available: Update | null
       - checking: boolean
       - downloading: boolean
       - progress: number (0-100)
       - error: string | null

    2. checkForUpdates():
       - Wrapped in try-catch (silent fail)
       - Timeout: 15000ms
       - Setzt available wenn Update vorhanden

    3. installUpdate():
       - downloadAndInstall() mit Progress-Callback
       - Tracked download progress
       - Ruft relaunch() nach Install auf

    4. Auto-Check bei Mount:
       - 3 Sekunden Delay nach App-Start
       - Silent fail bei Fehler (kein Toast)

    Imports:
    ```typescript
    import { check, Update } from '@tauri-apps/plugin-updater';
    import { relaunch } from '@tauri-apps/plugin-process';
    ```

    WICHTIG: Muster aus RESEARCH.md Code Examples verwenden.
  </action>
  <verify>yarn typecheck erfolgreich</verify>
  <done>Hook exportiert UpdateState und Funktionen, TypeScript kompiliert</done>
</task>

<task type="auto">
  <name>Task 2: UpdateNotification Header-Badge erstellen</name>
  <files>src/components/common/UpdateNotification.tsx, src/components/dashboard/DashboardHeader.tsx</files>
  <action>
    1. UpdateNotification.tsx erstellen:
       - Kleines Badge/Icon wenn Update verfügbar
       - onClick öffnet Update-Dialog (Modal)
       - Dezent, nicht aufdringlich
       - TailwindCSS für Styling (Discord-Dark-Theme passend)

    2. In DashboardHeader.tsx integrieren:
       - useUpdateCheck Hook verwenden
       - UpdateNotification rechts im Header platzieren
       - Nur anzeigen wenn update.available !== null

    Badge Design:
    - Kleiner Kreis oder Pfeil-Icon
    - Subtile Animation (optional: pulse bei neuem Update)
    - Tooltip: "Update available"
  </action>
  <verify>yarn typecheck && yarn lint erfolgreich</verify>
  <done>Badge erscheint im Header wenn Update verfügbar</done>
</task>

<task type="auto">
  <name>Task 3: Update-Dialog mit Changelog und Progress</name>
  <files>src/components/modals/UpdateModal.tsx, src/components/common/UpdateNotification.tsx</files>
  <action>
    1. UpdateModal.tsx erstellen:
       - Modal-Dialog (wie bestehende Modals im Projekt)
       - Zeigt: Version, Changelog-Kurzfassung
       - Buttons: "Later", "Install Update"
       - Progress-Bar während Download
       - "Restarting app..." Nachricht vor Install

       WICHTIG: Alle User-Facing Strings auf Englisch!

    2. Changelog-Kurzfassung:
       - update.body parsen (GitHub Release Notes)
       - Einfache Extraktion: Zähle "feat:", "fix:" Zeilen
       - Fallback: Ersten 2-3 Zeilen anzeigen
       - Beispiel: "2 new features, 1 bug fix"

    3. UpdateNotification anpassen:
       - State für Modal-Visibility
       - Klick öffnet UpdateModal

    WICHTIG:
    - Bestehende Modal-Patterns im Projekt folgen (src/components/modals/)
    - TailwindCSS, Discord-Dark-Theme
  </action>
  <verify>yarn typecheck && yarn lint erfolgreich</verify>
  <done>Modal zeigt Update-Info und ermöglicht Installation mit Progress</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] yarn typecheck erfolgreich
- [ ] yarn lint erfolgreich
- [ ] yarn tauri dev startet
- [ ] Keine Console-Errors im Browser DevTools
- [ ] Update-UI Komponenten gerendert (auch wenn kein echtes Update verfügbar)
</verification>

<success_criteria>
- Alle Tasks abgeschlossen
- Alle Verifikationen bestanden
- useUpdateCheck Hook funktioniert
- Header-Badge wird angezeigt (wenn Update verfügbar)
- Modal zeigt Changelog und Progress
- Bereit für CI/CD Integration (Plan 04-03)
</success_criteria>

<output>
After completion, create `.planning/phases/04-auto-updater/04-02-SUMMARY.md`
</output>
