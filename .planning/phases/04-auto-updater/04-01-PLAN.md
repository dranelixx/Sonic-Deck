---
phase: 04-auto-updater
plan: 01
type: execute
---

<objective>
Backend und Konfiguration für Tauri Auto-Updater einrichten.

Purpose: Technische Grundlage für Updates schaffen - Plugins, Konfiguration, Permissions.
Output: Funktionierende Updater-Infrastruktur im Backend, bereit für Frontend-Integration.

**Branch:** `feature/auto-updater` (von develop erstellen)
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-auto-updater/04-CONTEXT.md
@.planning/phases/04-auto-updater/04-RESEARCH.md

**Prior decisions affecting this phase:**
- Kein Code Signing (finanzielle Gründe) - SmartScreen-Warnung akzeptabel für Alpha-Tester
- User-kontrollierte Updates - kein automatischer Download

**Relevant source files:**
@src-tauri/src/lib.rs
@src-tauri/tauri.conf.json
@src-tauri/Cargo.toml
@src-tauri/capabilities/main-capability.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Tauri Updater Plugins installieren</name>
  <files>src-tauri/Cargo.toml, package.json</files>
  <action>
    1. Rust-Dependencies in Cargo.toml hinzufügen (unter desktop-only section):
       ```toml
       [target.'cfg(not(any(target_os = "android", target_os = "ios")))'.dependencies]
       tauri-plugin-updater = "2.0"
       tauri-plugin-process = "2.0"
       ```
    2. Frontend-Dependencies installieren:
       ```bash
       yarn add @tauri-apps/plugin-updater @tauri-apps/plugin-process
       ```

    WICHTIG: Bestehende desktop-only dependencies in Cargo.toml beibehalten (tauri-plugin-autostart etc.).
  </action>
  <verify>
    - cargo check --manifest-path src-tauri/Cargo.toml kompiliert ohne Fehler
    - yarn typecheck läuft durch
  </verify>
  <done>Beide Plugin-Pakete installiert, Projekt kompiliert</done>
</task>

<task type="auto">
  <name>Task 2: Plugins in Tauri registrieren und Konfiguration erweitern</name>
  <files>src-tauri/src/lib.rs, src-tauri/tauri.conf.json</files>
  <action>
    1. In lib.rs die Plugins registrieren (nach den bestehenden Plugins):
       ```rust
       .plugin(tauri_plugin_updater::Builder::new().build())
       .plugin(tauri_plugin_process::init())
       ```

    2. In tauri.conf.json die Updater-Konfiguration hinzufügen:
       - bundle.createUpdaterArtifacts: true
       - plugins.updater mit:
         - pubkey: "PLACEHOLDER_PUBKEY" (wird später durch echten Key ersetzt)
         - endpoints: ["https://github.com/DraneLixX/SonicDeck/releases/latest/download/latest.json"]
         - windows.installMode: "passive"

    WICHTIG:
    - Bestehende Plugins in lib.rs NICHT entfernen
    - Pubkey ist Placeholder - wird in Plan 03-03 durch echten Key ersetzt
  </action>
  <verify>
    - cargo check --manifest-path src-tauri/Cargo.toml kompiliert
    - tauri.conf.json ist valides JSON (yarn tauri info läuft)
  </verify>
  <done>Plugins registriert, tauri.conf.json enthält Updater-Konfiguration</done>
</task>

<task type="auto">
  <name>Task 3: Updater Capabilities hinzufügen</name>
  <files>src-tauri/capabilities/main-capability.json</files>
  <action>
    Folgende Permissions zur permissions-Liste hinzufügen:
    - "updater:default"
    - "process:allow-restart"
    - "process:allow-exit"

    WICHTIG: Bestehende Permissions beibehalten (core:*, dialog:*, global-shortcut:*, autostart:*, shell:*).
  </action>
  <verify>
    - JSON ist valide (kein Syntax-Fehler)
    - yarn tauri dev startet ohne Permission-Fehler
  </verify>
  <done>Updater-Permissions in main-capability.json hinzugefügt</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] cargo check --manifest-path src-tauri/Cargo.toml erfolgreich
- [ ] yarn typecheck erfolgreich
- [ ] yarn tauri dev startet ohne Fehler
- [ ] Keine bestehende Funktionalität gebrochen
</verification>

<success_criteria>
- Alle Tasks abgeschlossen
- Alle Verifikationen bestanden
- Tauri-App startet mit Updater-Plugins
- Bereit für Frontend-Integration (Plan 04-02)
</success_criteria>

<output>
After completion, create `.planning/phases/04-auto-updater/04-01-SUMMARY.md`
</output>
